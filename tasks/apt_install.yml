---
- name: python-apt dependency.
  apt:
    name: python-apt
    state: installed

- name: apt-transport-https dependency.
  apt:
    name: apt-transport-https
    state: installed

- name: Download Threat Stack apt repository key
  get_url:
    url: https://app.threatstack.com/APT-GPG-KEY-THREATSTACK
    dest: /tmp/threatstack.gpg

- name: Add Apt signing key on remote server to keyring
  apt_key:
    id: 6EE04BD4
    file: /tmp/threatstack.gpg
    state: present

- name: Remove threatstack gpg key
  file:
    path: /tmp/threatstack.gpg
    state: absent

- name: Add Threat Stack apt repository.
  apt_repository:
    repo: "deb {{ threatstack_pkg_url }}/Ubuntu {{ ansible_distribution_release }} main"
    state: present
    update_cache: yes

- name: Ensure Threat Stack is installed.
  apt:
    name: "{{ threatstack_pkg }}"
    state: "{{ threatstack_pkg_state }}"
